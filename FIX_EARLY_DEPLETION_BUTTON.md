# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è

**–î–∞—Ç–∞:** 15 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ - –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–¥—É–∫—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–í –Ω–∞–ª–∏—á–∏–∏" (ok)
- –ü—Ä–æ–¥—É–∫—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è —Ä–∞–Ω—å—à–µ –ø—Ä–æ–≥–Ω–æ–∑–∞
- –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –æ—Ä–∞–Ω–∂–µ–≤–æ–π –∫–Ω–æ–ø–∫–∏ (AlertTriangle) –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è"
- –ö–Ω–æ–ø–∫–∞ –Ω–µ –∏—Å—á–µ–∑–∞–µ—Ç

### –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –ª–æ–≥–∏–∫–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≤ –º–µ—Ç–æ–¥–µ `calculateProductStats()` –≤ —Ñ–∞–π–ª–µ `/src/services/supabaseService.ts`:

**–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø):**
```typescript
// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å, –∫–æ–≥–¥–∞ –±—ã–ª –∫—É–ø–ª–µ–Ω –ø—Ä–æ–¥—É–∫—Ç
if (daysSincePurchase < 2) {
  status = 'ok'  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è 'ok'
} else if (daysUntilEnd <= 2) {
  status = 'ending-soon'
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:**
1. ‚úÖ –°–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å `quantity=-1`
2. ‚úÖ –û–±–Ω–æ–≤–ª—è–ª—Å—è `last_purchase` –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
3. ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª—Å—è `avg_days` (—É–º–µ–Ω—å—à–∞–ª—Å—è)
4. ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª—Å—è `predicted_end` (—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –±–ª–∏–∂–µ –∫ —Å–µ–≥–æ–¥–Ω—è)
5. ‚ùå **–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞:** `daysSincePurchase = 0` (–∫—É–ø–ª–µ–Ω —Å–µ–≥–æ–¥–Ω—è) ‚Üí —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –≤ `'ok'`
6. ‚ùå –ü—Ä–æ–¥—É–∫—Ç –æ—Å—Ç–∞–≤–∞–ª—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `'ok'`, –∫–Ω–æ–ø–∫–∞ –Ω–µ –º–µ–Ω—è–ª–∞—Å—å

### –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏:

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ü–†–ê–í–ò–õ–¨–ù–ê–Ø):**
```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏ - —ç—Ç–æ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ?
const isEarlyDepletion = history.length > 0 && history[history.length - 1].quantity === -1

// –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –∫—É–ø–ª–µ–Ω –Ω–µ–¥–∞–≤–Ω–æ –ò —ç—Ç–æ –ù–ï –¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ
if (daysSincePurchase < 2 && !isEarlyDepletion) {
  status = 'ok'  // –ì–∞—Ä–∞–Ω—Ç–∏—è –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫
} else if (daysUntilEnd <= 2) {
  status = 'ending-soon'  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–ª—è –¥–æ—Å—Ä–æ—á–Ω—ã—Ö –æ–∫–æ–Ω—á–∞–Ω–∏–π
}
```

**–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:**
- –î–ª—è **–æ–±—ã—á–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫** (–∏–∑ —á–µ–∫–æ–≤): –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è —Å—Ç–∞—Ç—É—Å–∞ `'ok'`
- –î–ª—è **–¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è** (`quantity=-1`): –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–∞—Ç—ã –ø–æ–∫—É–ø–∫–∏

**–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏:**
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å —Å `quantity=-1`
2. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `last_purchase` –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
3. ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `avg_days` (—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è)
4. ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `predicted_end` (—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–ª–∏–∂–µ/—É–∂–µ –ø—Ä–æ—à–µ–ª)
5. ‚úÖ –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞: `daysUntilEnd <= 2` ‚Üí —Å—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `'ending-soon'`
6. ‚úÖ –û—Ä–∞–Ω–∂–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–∏

## –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `/src/services/supabaseService.ts`
- **–ú–µ—Ç–æ–¥:** `calculateProductStats()`
- **–°—Ç—Ä–æ–∫–∏:** 337-349
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ —É—Å–ª–æ–≤–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### ‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞
–ù–∞—à–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø–æ–∫—É–ø–∫—É:
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏: `quantity=0` (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞)
- `isEarlyDepletion = false` (—ç—Ç–æ –Ω–µ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ)
- `daysSincePurchase < 2` ‚Üí —Å—Ç–∞—Ç—É—Å `'ok'` (–≥–∞—Ä–∞–Ω—Ç–∏—è 2 –¥–Ω—è)
- –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

### ‚úÖ –û–±—ã—á–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ –∏–∑ —á–µ–∫–æ–≤
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏: `quantity > 0` (–æ–±—ã—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞)
- `isEarlyDepletion = false`
- `daysSincePurchase < 2` ‚Üí —Å—Ç–∞—Ç—É—Å **–í–°–ï–ì–î–ê** `'ok'` (–≥–∞—Ä–∞–Ω—Ç–∏—è 2 –¥–Ω—è)
- –î–∞–∂–µ –µ—Å–ª–∏ `avg_days` –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π (1 –¥–µ–Ω—å), –ø—Ä–æ–¥—É–∫—Ç –±—É–¥–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏ –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è ‚úÖ

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç
- –ö–æ–≥–¥–∞ –ø—Ä–æ–¥—É–∫—Ç—ã –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –ø–æ–¥—Ö–æ–¥—è—Ç –∫ –∫–æ–Ω—Ü—É —Å—Ä–æ–∫–∞
- `daysSincePurchase >= 2` (–ø—Ä–æ—à–ª–æ 2+ –¥–Ω—è)
- `daysUntilEnd <= 2` ‚Üí —Å—Ç–∞—Ç—É—Å `'ending-soon'`
- –°—Ç–∞—Ç—É—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è ‚úÖ

### ‚úÖ –î–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏: `quantity=-1` (–¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ)
- `isEarlyDepletion = true`
- –£—Å–ª–æ–≤–∏–µ `daysSincePurchase < 2 && !isEarlyDepletion` = false
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `daysUntilEnd <= 2` ‚Üí —Å—Ç–∞—Ç—É—Å `'ending-soon'`
- –ö–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚úÖ

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–í –Ω–∞–ª–∏—á–∏–∏" (–∑–µ–ª–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞)
2. –ù–∞–∂–º–∏—Ç–µ –æ—Ä–∞–Ω–∂–µ–≤—É—é –∫–Ω–æ–ø–∫—É —Å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–º (AlertTriangle) –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è" (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞)
   - –û—Ä–∞–Ω–∂–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç
   - –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (RefreshCw)
   - `avg_days` —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
   - `predicted_end` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–ª–∏–∂–µ –∫ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ

## –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
‚ö†Ô∏è –û—Ç–º–µ—á–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–∏–ø–∞ –∫–∞–∫ –¥–æ—Å—Ä–æ—á–Ω–æ –∑–∞–∫–æ–Ω—á–∏–≤—à–∏–µ—Å—è: –∫—Ä–µ–≤–µ—Ç–∫–∏
‚ö†Ô∏è –û—Ç–º–µ—á–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç #123 –∫–∞–∫ –¥–æ—Å—Ä–æ—á–Ω–æ –∑–∞–∫–æ–Ω—á–∏–≤—à–∏–π—Å—è
üìä –ü—Ä–æ–¥—É–∫—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è —á–µ—Ä–µ–∑ 3 –¥–Ω—è –≤–º–µ—Å—Ç–æ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã—Ö 5
‚úÖ –ó–∞–ø–∏—Å—å –æ –¥–æ—Å—Ä–æ—á–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
‚úÖ last_purchase –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
üìä –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ —Å—Ä–µ–¥–Ω–µ–µ: 4 –¥–Ω–µ–π (–Ω–∞ –æ—Å–Ω–æ–≤–µ X –ø–æ–∫—É–ø–æ–∫, Y –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤)
‚ö†Ô∏è –î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è 1 –¥–Ω–µ–π (–¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ), —Å—Ç–∞—Ç—É—Å = ending-soon  <-- –ò–°–ü–†–ê–í–õ–ï–ù–û!
‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞, avg_days —É–º–µ–Ω—å—à–µ–Ω, —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω
‚úÖ 1 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –¥–æ—Å—Ä–æ—á–Ω–æ –∑–∞–∫–æ–Ω—á–∏–≤—à–∏–µ—Å—è
‚úÖ –ü—Ä–æ–¥—É–∫—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
```

–î–ª—è –æ–±—ã—á–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
‚úÖ –ü—Ä–æ–¥—É–∫—Ç –∫—É–ø–ª–µ–Ω —Å–µ–≥–æ–¥–Ω—è, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤ –Ω–∞–ª–∏—á–∏–∏ –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è, —Å—Ç–∞—Ç—É—Å = ok
```

## –î–µ–ø–ª–æ–π

1. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
git add src/services/supabaseService.ts FIX_EARLY_DEPLETION_BUTTON.md
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è"
```

2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Vercel:
```bash
git push origin main
```

3. –î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å—Ç–∞—Ç—É—Å–∞

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É):**
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1:** –ü—Ä–æ–¥—É–∫—Ç –∫—É–ø–ª–µ–Ω –Ω–µ–¥–∞–≤–Ω–æ (`daysSincePurchase < 2`) –ò —ç—Ç–æ –ù–ï –¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ (`!isEarlyDepletion`)
   - ‚Üí `'ok'` (–≥–∞—Ä–∞–Ω—Ç–∏—è –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫)
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2:** –î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è <= 2 –¥–Ω—è (`daysUntilEnd <= 2`)
   - ‚Üí `'ending-soon'` (–¥–ª—è –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–ª–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è)
3. **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `'ok'`

### –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `isEarlyDepletion`?

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –ø–æ–∫—É–ø–æ–∫:

**1. –û–±—ã—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ (–∏–∑ —á–µ–∫–∞):**
- `quantity > 0`
- `isEarlyDepletion = false`
- –ì–∞—Ä–∞–Ω—Ç–∏—è: —Å—Ç–∞—Ç—É—Å `'ok'` –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è
- **–ó–∞—á–µ–º:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ –ø—Ä–æ–¥—É–∫—Ç —Å –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–º `avg_days` (1 –¥–µ–Ω—å) —Å—Ä–∞–∑—É –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ "–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è" –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏

**2. –î–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ (–∫–Ω–æ–ø–∫–∞):**
- `quantity = -1`
- `isEarlyDepletion = true`
- –°—Ç–∞—Ç—É—Å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `daysUntilEnd`, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –¥–∞—Ç—É –ø–æ–∫—É–ø–∫–∏
- **–ó–∞—á–µ–º:** –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–∑—É –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ `'ending-soon'`, –¥–∞–∂–µ –µ—Å–ª–∏ `last_purchase` –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

**–ü—Ä–∏–º–µ—Ä 1: –û–±—ã—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ —Å –º–∞–ª–µ–Ω—å–∫–∏–º avg_days**
- –ö—É–ø–∏–ª–∏ —Ö–ª–µ–± —Å–µ–≥–æ–¥–Ω—è (quantity=2)
- avg_days = 1 –¥–µ–Ω—å
- predicted_end = –∑–∞–≤—Ç—Ä–∞
- daysUntilEnd = 1 (<=2)
- isEarlyDepletion = false (–ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å quantity=2)
- ‚úÖ –°—Ç–∞—Ç—É—Å = `'ok'` (–≥–∞—Ä–∞–Ω—Ç–∏—è 2 –¥–Ω—è —Ä–∞–±–æ—Ç–∞–µ—Ç)

**–ü—Ä–∏–º–µ—Ä 2: –î–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ**
- –ù–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è (quantity=-1)
- last_purchase = —Å–µ–≥–æ–¥–Ω—è
- avg_days –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω = 3 –¥–Ω—è
- predicted_end = —á–µ—Ä–µ–∑ 3 –¥–Ω—è
- daysUntilEnd = 3 (–Ω–æ —ç—Ç–æ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ!)
- isEarlyDepletion = true
- –£—Å–ª–æ–≤–∏–µ `daysSincePurchase < 2 && !isEarlyDepletion` = false
- daysUntilEnd <= 2? –ù–µ—Ç, –Ω–æ —ç—Ç–æ –Ω–µ –≤–∞–∂–Ω–æ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
- ‚úÖ –°—Ç–∞—Ç—É—Å = `'ending-soon'` (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –æ–∫–æ–Ω—á–∞–Ω–∏–∏ avg_days —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞—Å—Ç–æ–ª—å–∫–æ, —á—Ç–æ daysUntilEnd –æ–±—ã—á–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è <= 2*

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `EARLY_DEPLETION_FEATURE.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `VIRTUAL_PURCHASE_FEATURE.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–µ
- `/src/GroceryTrackerApp.tsx` (—Å—Ç—Ä–æ–∫–∏ 482-512) - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleEarlyDepletion`
- `/src/services/supabaseService.ts` (—Å—Ç—Ä–æ–∫–∏ 1455-1512) - –º–µ—Ç–æ–¥ `markAsDepletedEarly`

