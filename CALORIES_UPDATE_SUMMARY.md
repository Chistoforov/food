# Автоматический пересчет статистики при изменении калорийности

## Что было реализовано

✅ **Автоматический пересчет статистики** - при изменении калорийности продукта вся статистика пересчитывается автоматически

✅ **Триггеры базы данных** - добавлены триггеры для автоматического пересчета при изменении данных

✅ **Обновленный интерфейс** - добавлены уведомления пользователю о пересчете статистики

✅ **Ручной пересчет** - добавлена кнопка для ручного обновления статистики

## Как это работает

1. **При изменении калорийности продукта:**
   - Срабатывает триггер `recalculate_stats_on_product_update`
   - Пересчитывается статистика для текущего месяца
   - Пересчитывается статистика для всех месяцев, где есть покупки этого продукта

2. **При добавлении новой покупки:**
   - Срабатывает триггер `recalculate_stats_on_history_insert`
   - Пересчитывается статистика для месяца покупки

3. **В интерфейсе:**
   - Пользователь видит уведомление о пересчете статистики
   - Есть кнопка для ручного обновления статистики
   - Статистика обновляется в реальном времени

## Файлы, которые были изменены

- `database_schema.sql` - добавлены функции и триггеры
- `src/services/supabaseService.ts` - добавлены методы пересчета
- `src/hooks/useSupabaseData.ts` - обновлены хуки
- `src/GroceryTrackerApp.tsx` - обновлен интерфейс

## Тестирование

Запустите `test_calories_update.js` в консоли браузера для проверки функциональности.

## Развертывание

1. Выполните обновленный `database_schema.sql` в Supabase
2. Перезапустите приложение
3. Протестируйте изменение калорийности продукта
