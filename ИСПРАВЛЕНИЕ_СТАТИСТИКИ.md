# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

## –ü—Ä–æ–±–ª–µ–º–∞
–£ –≤–∞—Å –µ—Å—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ–∫–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏, –Ω–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω—É–ª–∏.

## –ü—Ä–∏—á–∏–Ω–∞
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `monthly_stats` –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —á–µ–∫–æ–≤, –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Supabase Dashboard (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor**
3. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ SQL —Å–∫—Ä–∏–ø—Ç–æ–≤:**

#### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–¥–µ–∫–∞–±—Ä—å 2024):
```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ fix_current_month_stats.sql
```

#### –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤ —Å —á–µ–∫–∞–º–∏:
```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ check_all_months_with_receipts.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ HTML —Ç–µ—Å—Ç–µ—Ä

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `test_stats_fix.html`** –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. **–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ Supabase:**
   - Supabase URL (–∏–∑ Settings > API > Project URL)
   - Supabase Anon Key (–∏–∑ Settings > API > Project API keys)
3. **–ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Supabase"**
4. **–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ"** - —É–≤–∏–¥–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
5. **–ù–∞–∂–º–∏—Ç–µ "–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å Node.js

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   export VITE_SUPABASE_URL="https://your-project.supabase.co"
   export VITE_SUPABASE_ANON_KEY="your-anon-key"
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:**
   ```bash
   node test_stats_console.js
   ```

## –ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∫—Ä–∏–ø—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä—è—é—Ç –¥–∞–Ω–Ω—ã–µ** –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö:
   - `receipts` - –≤–∞—à–∏ —á–µ–∫–∏
   - `products` - –ø—Ä–æ–¥—É–∫—Ç—ã
   - `product_history` - –∏—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫
   - `monthly_stats` - —Ç–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

2. **–ù–∞—Ö–æ–¥—è—Ç –≤—Å–µ –º–µ—Å—è—Ü—ã —Å —á–µ–∫–∞–º–∏** –∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç –∏—Ö

3. **–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞:
   - –û–±—â–∞—è —Å—É–º–º–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã—Ö –¥–µ–Ω–µ–≥
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ª–æ—Ä–∏–π
   - –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–ª–æ—Ä–∏–π –≤ –¥–µ–Ω—å
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤

4. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –≤ —Ç–∞–±–ª–∏—Ü—É `monthly_stats`

## –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É** –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –º–µ—Å—è—Ü–∞–º–∏** - –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è

### ‚ö†Ô∏è –í–∞–∂–Ω–æ!

**–ö–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –º–µ—Å—è—Ü–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –§–æ—Ä–º–∞—Ç –º–µ—Å—è—Ü–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ `monthly_stats` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `'YYYY-MM'` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'2024-12'`), –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –µ–≥–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

–ï—Å–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ –µ—â–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ `month` –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç `'YYYY-MM'`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª–µ `year` –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

## –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –≤ –±—É–¥—É—â–µ–º:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–û–±–Ω–æ–≤–∏—Ç—å"** –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–∫–æ–≤
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç** –≤ Supabase Dashboard
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** –ø–æ—Å–ª–µ –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

## –§–∞–π–ª—ã –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- `fix_current_month_stats.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
- `check_all_months_with_receipts.sql` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤
- `test_stats_fix.html` - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `test_stats_console.js` - –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π —Ç–µ—Å—Ç

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ —Ç–∞–±–ª–∏—Ü–∞–º –≤ Supabase
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ Supabase Dashboard –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** Supabase –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ RLS

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã –∏ –Ω–µ —É–¥–∞–ª—è—é—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
