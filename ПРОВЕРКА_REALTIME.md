# üì° –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Realtime –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —á–µ–∫–æ–≤

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

Realtime –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ–∫–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
- ‚úÖ –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è —Å "–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏" –Ω–∞ "–û–±—Ä–∞–±–æ—Ç–∞–Ω" –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –æ–±—Ä–∞—Ç–Ω—ã–º –æ—Ç—Å—á–µ—Ç–æ–º
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ Realtime –Ω–µ –≤–∫–ª—é—á–µ–Ω, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç polling (–ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã) –∫–∞–∫ fallback –º–µ—Ö–∞–Ω–∏–∑–º. –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è, –Ω–æ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

---

## ‚úÖ –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Supabase Dashboard (–±—ã—Å—Ç—Ä–µ–µ)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Replication** (—Å–ª–µ–≤–∞ –≤ –º–µ–Ω—é)
4. –ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `pending_receipts`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä—è–¥–æ–º —Å –Ω–µ–π:
   - ‚úÖ **–ó–µ–ª–µ–Ω—ã–π (–≤–∫–ª—é—á–µ–Ω)** - Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç! 
   - ‚ùå **–°–µ—Ä—ã–π (–≤—ã–∫–ª—é—á–µ–Ω)** - –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å (—Å–º. –®–∞–≥ 2)

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ SQL (–¥–ª—è —Ç–µ—Ö–Ω–∞—Ä–µ–π)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞: –≤–∫–ª—é—á–µ–Ω –ª–∏ Realtime –¥–ª—è pending_receipts
SELECT 
  schemaname, 
  tablename,
  'Realtime –≤–∫–ª—é—á–µ–Ω ‚úÖ' as status
FROM pg_publication_tables 
WHERE pubname = 'supabase_realtime'
AND tablename = 'pending_receipts';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É —Å `pending_receipts` - **Realtime –≤–∫–ª—é—á–µ–Ω ‚úÖ**
- –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è - **Realtime –≤—ã–∫–ª—é—á–µ–Ω ‚ùå** (–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ –®–∞–≥—É 2)

---

## üîß –®–∞–≥ 2: –í–∫–ª—é—á–µ–Ω–∏–µ Realtime

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Supabase Dashboard (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **Replication**
4. –ù–∞–π–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `pending_receipts`
5. **–í–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å** —Ä—è–¥–æ–º —Å –Ω–µ–π
6. –ì–æ—Ç–æ–≤–æ! ‚úÖ

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ SQL

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor**
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –í–∫–ª—é—á–∏—Ç—å Realtime –¥–ª—è pending_receipts
ALTER PUBLICATION supabase_realtime ADD TABLE pending_receipts;
```

5. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl/Cmd + Enter)
6. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ: `Success. No rows returned`
7. –ì–æ—Ç–æ–≤–æ! ‚úÖ

---

## üß™ –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ **F12** (–∏–ª–∏ Cmd+Option+I –Ω–∞ Mac) - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Console**
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **–ß–µ–∫** –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
5. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```
üîÑ UploadPage: –ó–∞–≥—Ä—É–∂–∞–µ–º pending receipts –∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
üîî –°–æ–∑–¥–∞–µ–º realtime –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ pending_receipts –¥–ª—è family: 1
‚è≤Ô∏è UploadPage: –ó–∞–ø—É—Å–∫–∞–µ–º polling fallback (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)
üì° –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏: SUBSCRIBED
‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è pending_receipts
```

‚úÖ –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `SUBSCRIBED` - **Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç!**

### –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ–∫–∞

1. –û—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫–µ **–ß–µ–∫**
2. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞ (F12)
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —á–µ–∫–∞ (–ö–∞–º–µ—Ä–∞ –∏–ª–∏ –ì–∞–ª–µ—Ä–µ—è)
4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:**
```
üì§ Uploading receipt for background processing...
‚úÖ Receipt uploaded, triggering background processing...
```

**–í–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã —á–µ—Ä–µ–∑ polling):**
```
üîÑ Polling: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å pending receipts
```

**–ö–æ–≥–¥–∞ —á–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω (—á–µ—Ä–µ–∑ Realtime):**
```
üì° UploadPage: –ü–æ–ª—É—á–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ–∫–∞: { id: 123, status: 'completed', ... }
‚úÖ UploadPage: –ß–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
‚è±Ô∏è –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è —á–µ–∫–∞: 123
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã:**
```
üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —á–µ–∫: 123
‚úÖ –ß–µ–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω
üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —á–µ–∫–∞
```

‚úÖ –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —ç—Ç–∏ –ª–æ–≥–∏ - **–≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

### –¢–µ—Å—Ç 3: –í–∏–∑—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫
2. –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –º–µ–Ω—è—Ç—å—Å—è —Ç–∞–∫:
   - üü° **"–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏..."** (—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏)
   - üîµ **"–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è..."** (–∫–æ–≥–¥–∞ —Å–µ—Ä–≤–µ—Ä –Ω–∞—á–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫—É)
   - ‚úÖ **"–û–±—Ä–∞–±–æ—Ç–∞–Ω ‚úÖ (–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3—Å)"** (–∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ)
   - *–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—á–µ–∑–∞–µ—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã*

3. –í–æ –≤—Ä–µ–º—è —Ñ–∞–∑—ã "–û–±—Ä–∞–±–æ—Ç–∞–Ω" –≤—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç:
   - "–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3—Å"
   - "–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 2—Å"
   - "–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 1—Å"
   - *–∏—Å—á–µ–∑–∞–µ—Ç*

‚úÖ –ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–æ - **—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!**

---

## ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ –≤–∏–∂—É –ª–æ–≥ "SUBSCRIBED" –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ü—Ä–∏—á–∏–Ω–∞:** Realtime –Ω–µ –≤–∫–ª—é—á–µ–Ω –≤ Supabase

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ **–®–∞–≥—É 2** –∏ –≤–∫–ª—é—á–∏—Ç–µ Realtime
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (F5)
3. –°–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞ 1:** Realtime –Ω–µ –≤–∫–ª—é—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
- –í–∫–ª—é—á–∏—Ç–µ Realtime (—Å–º. –®–∞–≥ 2)
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å polling (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã)

**–ü—Ä–∏—á–∏–Ω–∞ 2:** –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

**–ü—Ä–∏—á–∏–Ω–∞ 3:** –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å —á–µ–∫–∞ - –µ—Å–ª–∏ "–û—à–∏–±–∫–∞", –Ω–∞–∂–º–∏—Ç–µ X —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ–∫ –µ—â–µ —Ä–∞–∑
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å Vercel (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø) –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ß–µ–∫ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã

**–ü—Ä–∏—á–∏–Ω–∞:** –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏:
- –í—ã –≤—Ä—É—á–Ω—É—é –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É X
- –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞–∂–º–∏—Ç–µ X –≤—Ä—É—á–Ω—É—é —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å
- –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è

---

## üîç –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è pending_receipts

Realtime –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –µ—Å–ª–∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS –ø–æ–ª–∏—Ç–∏–∫
SELECT 
  policyname as "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏", 
  cmd as "–ö–æ–º–∞–Ω–¥–∞",
  qual as "–£—Å–ª–æ–≤–∏–µ",
  permissive as "–†–∞–∑—Ä–µ—à–∞—é—â–∞—è"
FROM pg_policies
WHERE tablename = 'pending_receipts';
```

**–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –ø–æ–ª–∏—Ç–∏–∫–∏:**
1. `Users can view pending receipts from their family` - –¥–ª—è SELECT
2. `Users can insert pending receipts for their family` - –¥–ª—è INSERT

–ï—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫ –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
ALTER TABLE pending_receipts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view pending receipts from their family"
ON pending_receipts FOR SELECT
USING (
  family_id IN (
    SELECT family_id FROM family_members WHERE user_id = auth.uid()
  )
);

CREATE POLICY "Users can insert pending receipts for their family"
ON pending_receipts FOR INSERT
WITH CHECK (
  family_id IN (
    SELECT family_id FROM family_members WHERE user_id = auth.uid()
  )
);
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

–ß—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ 2 –≤–∫–ª–∞–¥–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞ (–∏–ª–∏ –Ω–∞ 2 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)
2. –í –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ–∫
3. –í –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ (–∫–æ–Ω—Å–æ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞):
   - –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥ `üì° Realtime —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª—É—á–µ–Ω–æ`
   - –°—Ç–∞—Ç—É—Å —á–µ–∫–∞ –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–≠—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ

---

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö pending receipts

```sql
SELECT 
  id,
  family_id,
  status,
  created_at,
  processed_at,
  attempts,
  error_message
FROM pending_receipts
ORDER BY created_at DESC
LIMIT 10;
```

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö completed/failed –∑–∞–ø–∏—Å–µ–π

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ —á–µ–∫–∏ —Å—Ç–∞—Ä—à–µ 1 –¥–Ω—è
DELETE FROM pending_receipts
WHERE status IN ('completed', 'failed')
AND processed_at < NOW() - INTERVAL '1 day';
```

### –°–±—Ä–æ—Å –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö —á–µ–∫–æ–≤

```sql
-- –ï—Å–ª–∏ —á–µ–∫ –∑–∞—Å—Ç—Ä—è–ª –≤ —Å—Ç–∞—Ç—É—Å–µ 'processing' –±–æ–ª—å—à–µ 5 –º–∏–Ω—É—Ç
UPDATE pending_receipts
SET status = 'failed',
    error_message = 'Processing timeout - stuck for more than 5 minutes',
    processed_at = NOW()
WHERE status = 'processing'
AND created_at < NOW() - INTERVAL '5 minutes';
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] Realtime –≤–∫–ª—é—á–µ–Ω –¥–ª—è `pending_receipts` –≤ Supabase
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –≤–∏–¥–Ω–æ `SUBSCRIBED`
- [ ] –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ–∫–∞ —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á–µ—Ç "–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ X—Å"
- [ ] –ß–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ–∫–∞

–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã - **–ø–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!** üéâ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `REALTIME_QUICK_START_RU.md` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ Realtime
- `README_–û–ë–ù–û–í–õ–ï–ù–ò–ï_02_11_2025.md` - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `CHANGELOG_02_11_2025.md` - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
- `BACKGROUND_RECEIPT_PROCESSING.md` - –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–æ–≤
- `enable_realtime_for_pending_receipts.sql` - SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è Realtime

---

## üÜò –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)
2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —ç–∫—Ä–∞–Ω–∞ —Å –ø—Ä–æ–±–ª–µ–º–æ–π
3. –û–ø–∏—à–∏—Ç–µ —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –£–∫–∞–∂–∏—Ç–µ:
   - –ë—Ä–∞—É–∑–µ—Ä –∏ –≤–µ—Ä—Å–∏—é
   - –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É
   - –ß—Ç–æ –≤—ã —É–∂–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∏

