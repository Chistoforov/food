# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é cron job, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –≤ 1:00 –ø–æ UTC.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–î–æ:**
```
–•–ª–µ–± –±–µ–ª—ã–π
–í—Å–µ–≥–æ: 2
–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è: 1
–†–∞—Å—Å—á–µ—Ç: 1
```

**–ü–æ—Å–ª–µ:**
```
–•–ª–µ–±
–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
```

–¢–µ–ø–µ—Ä—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **–∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Ç–∏–ø–∞ –ø—Ä–æ–¥—É–∫—Ç–∞**:
- –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç —Ç–∏–ø–∞ "–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è", —Ç–æ –≤–µ—Å—å —Ç–∏–ø –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è"
- –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–∏–ø–∞ "–≤ –Ω–∞–ª–∏—á–∏–∏", —Ç–æ —Ç–∏–ø –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–í –Ω–∞–ª–∏—á–∏–∏"
- –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã —Ç–∏–ø–∞ "—Ä–∞—Å—á–µ—Ç...", —Ç–æ —Ç–∏–ø –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–†–∞—Å—á–µ—Ç..."

### 2. –ü—Ä–∞–≤–∏–ª–æ 2-—Ö –¥–Ω–µ–π

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤–∞–∂–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ: **–ø—Ä–æ–¥—É–∫—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è" –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏**.

**–ü—Ä–∏–º–µ—Ä:**
- –í—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ –º–æ–ª–æ–∫–æ –∫–∞–∂–¥—ã–µ 3 –¥–Ω—è
- 4 –Ω–æ—è–±—Ä—è –≤—ã –∫—É–ø–∏–ª–∏ –º–æ–ª–æ–∫–æ
- 5 –∏ 6 –Ω–æ—è–±—Ä—è –º–æ–ª–æ–∫–æ **–Ω–µ –º–æ–∂–µ—Ç** –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è"
- –í 1:00 7 –Ω–æ—è–±—Ä—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Å—á–µ—Ç
- 7 –Ω–æ—è–±—Ä—è - 4 –Ω–æ—è–±—Ä—è = 3 –¥–Ω—è
- –° 7 –Ω–æ—è–±—Ä—è –º–æ–ª–æ–∫–æ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å "–∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è"

**–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
// –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç –∫—É–ø–ª–µ–Ω –Ω–µ–¥–∞–≤–Ω–æ (–º–µ–Ω—å—à–µ 2 –¥–Ω–µ–π –Ω–∞–∑–∞–¥), —Å—Ç–∞—Ç—É—Å –≤—Å–µ–≥–¥–∞ "ok"
if (daysSincePurchase < 2) {
  status = 'ok';
} else if (daysUntilEnd <= 2) {
  status = 'ending-soon';
}
```

### 3. Cron Job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞

**–§–∞–π–ª:** `/api/recalculate-statuses.js`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –≤ 1:00 UTC
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–º–µ–π
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ 2-—Ö –¥–Ω–µ–π –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ vercel.json:**
```json
"crons": [
  {
    "path": "/api/recalculate-statuses",
    "schedule": "0 1 * * *"
  }
]
```

**Schedule —Ñ–æ—Ä–º–∞—Ç:** `0 1 * * *` (cron expression)
- `0` - 0 –º–∏–Ω—É—Ç
- `1` - 1 —á–∞—Å (1:00 UTC)
- `*` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- `*` - –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü
- `*` - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏

## –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API

### SupabaseService.recalculateAllProductStatuses(familyId)

–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å–µ–º—å–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `familyId` (number) - ID —Å–µ–º—å–∏

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```javascript
{
  success: boolean,
  productsUpdated: number,
  errors: number
}
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```javascript
const result = await SupabaseService.recalculateAllProductStatuses(1);
console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: ${result.productsUpdated}`);
```

### API Endpoint: /api/recalculate-statuses

**–ú–µ—Ç–æ–¥:** GET –∏–ª–∏ POST

**–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
```
Authorization: Bearer YOUR_CRON_SECRET
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "timestamp": "2024-11-04T01:00:00.000Z",
  "familiesProcessed": 2,
  "totalProductsUpdated": 45,
  "totalErrors": 0,
  "results": [
    {
      "familyId": 1,
      "familyName": "–ú–æ—è —Å–µ–º—å—è",
      "productsUpdated": 30,
      "errors": 0
    },
    {
      "familyId": 2,
      "familyName": "–†–æ–¥–∏—Ç–µ–ª–∏",
      "productsUpdated": 15,
      "errors": 0
    }
  ]
}
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è cron job:

```bash
# –í .env –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Vercel
CRON_SECRET=your-secret-token-here
```

–ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `CRON_SECRET` endpoint –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
```bash
curl -X POST https://your-app.vercel.app/api/recalculate-statuses \
  -H "Authorization: Bearer your-secret-token-here"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ cron job

–í—ã –º–æ–∂–µ—Ç–µ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–µ—Ä–µ—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤:

```bash
# –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
curl https://your-app.vercel.app/api/recalculate-statuses

# –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
curl https://your-app.vercel.app/api/recalculate-statuses \
  -H "Authorization: Bearer your-secret-token"
```

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
curl http://localhost:5173/api/recalculate-statuses
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –≤ Vercel

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ vercel.com
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "Deployments"
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Functions"
5. –ù–∞–π–¥–∏—Ç–µ `api/recalculate-statuses.js`
6. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –õ–æ–≥–∏ –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

```
‚è∞ –ó–∞–ø—É—Å–∫ cron job –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚è∞ –í—Ä–µ–º—è: 2024-11-04T01:00:00.000Z
üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –ù–∞–π–¥–µ–Ω–æ 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–º–µ–π
üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Å—á–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è —Å–µ–º—å–∏ 1
üì¶ –ù–∞–π–¥–µ–Ω–æ 30 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è —Å–µ–º—å–∏ 1
‚úÖ –°–µ–º—å—è 1: –æ–±–Ω–æ–≤–ª–µ–Ω–æ 30, –æ—à–∏–±–æ–∫ 0
‚úÖ Cron job –∑–∞–≤–µ—Ä—à–µ–Ω
üìä –í—Å–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: 45
‚ùå –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: 0
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **UTC –≤—Ä–µ–º—è:** Cron job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ 1:00 UTC. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –≤–∞—à–µ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.

2. **–¢–∞—Ä–∏—Ñ–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:** –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω Vercel –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å cron jobs —Ä–∞–∑ –≤ –¥–µ–Ω—å. –î–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è Pro –ø–ª–∞–Ω.

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (>1000) –ø–µ—Ä–µ—Å—á–µ—Ç –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç. –ö–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.

4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–∞–≤–∏–ª–æ 2-—Ö –¥–Ω–µ–π –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –∫–æ–¥–µ API, –∞ –Ω–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î.

## –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

```javascript
// 1. –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–æ–∫ (–¥–ª—è —Ç–∏–ø–∞ –∏–ª–∏ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞)
// 2. –í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –º–µ–∂–¥—É –ø–æ–∫—É–ø–∫–∞–º–∏
// 3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—É—é –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è
// 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ 2-—Ö –¥–Ω–µ–π:

if (daysSincePurchase < 2) {
  // –ö—É–ø–ª–µ–Ω –Ω–µ–¥–∞–≤–Ω–æ - –≤—Å–µ–≥–¥–∞ –û–ö
  status = 'ok';
} else if (daysUntilEnd <= 2) {
  // –î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è 2 –¥–Ω—è –∏–ª–∏ –º–µ–Ω—å—à–µ - –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è
  status = 'ending-soon';
} else {
  // –í—Å—ë —Ö–æ—Ä–æ—à–æ
  status = 'ok';
}
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### GroceryTrackerApp.tsx

**–ò–∑–º–µ–Ω–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:**
- –£–¥–∞–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Ç–∏–ø–µ
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ç—É—Å
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π/–∑–µ–ª–µ–Ω—ã–π/—Å–∏–Ω–∏–π)

### supabaseService.ts

**–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥:**
- `recalculateAllProductStatuses(familyId)` - –ø–µ—Ä–µ—Å—á–µ—Ç –≤—Å–µ—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è —Å–µ–º—å–∏

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
```bash
git add .
git commit -m "feat: –¥–æ–±–∞–≤–ª–µ–Ω cron job –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –ø—Ä–∞–≤–∏–ª–æ–º 2-—Ö –¥–Ω–µ–π"
git push
```

2. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

3. Cron job –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

4. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –≤ 1:00 UTC

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### Cron job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `vercel.json` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–¥–µ–ø–ª–æ–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard

### –û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Supabase
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É Supabase –∫–ª–∏–µ–Ω—Ç–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–∞–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ Vercel

### –°—Ç–∞—Ç—É—Å—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ cron job
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –µ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫ (–º–∏–Ω–∏–º—É–º 2)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `vercel.json`:

```json
"crons": [
  {
    "path": "/api/recalculate-statuses",
    "schedule": "0 2 * * *"  // 2:00 UTC –≤–º–µ—Å—Ç–æ 1:00
  }
]
```

### –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email/webhook –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

```javascript
if (totalErrors > 0) {
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  await sendNotification({
    subject: '–û—à–∏–±–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á–µ—Ç–µ —Å—Ç–∞—Ç—É—Å–æ–≤',
    body: `–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${totalErrors} –æ—à–∏–±–æ–∫`
  });
}
```

## Changelog

### 2024-11-04
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∏–ª–æ 2-—Ö –¥–Ω–µ–π –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `recalculateAllProductStatuses` –≤ SupabaseService

