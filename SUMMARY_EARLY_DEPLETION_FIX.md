# –†–µ–∑—é–º–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è

**–î–∞—Ç–∞:** 15 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∞

–ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥—É–∫—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è —Ä–∞–Ω—å—à–µ" (–æ—Ä–∞–Ω–∂–µ–≤–∞—è, —Å —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–æ–º) –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `src/services/supabaseService.ts`  
**–ú–µ—Ç–æ–¥:** `calculateProductStats()`  
**–°—Ç—Ä–æ–∫–∏:** 337-350

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏–∏
const isEarlyDepletion = history.length > 0 && history[history.length - 1].quantity === -1

// –ì–∞—Ä–∞–Ω—Ç–∏—è 2 –¥–Ω—è –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫, –Ω–æ –ù–ï –¥–ª—è –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
if (daysSincePurchase < 2 && !isEarlyDepletion) {
  status = 'ok'
} else if (daysUntilEnd <= 2) {
  status = 'ending-soon'
}
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –û–±—ã—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ (–∏–∑ —á–µ–∫–∞)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å: `quantity > 0`
- `isEarlyDepletion = false`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì–∞—Ä–∞–Ω—Ç–∏—è –º–∏–Ω–∏–º—É–º 2 –¥–Ω—è —Å—Ç–∞—Ç—É—Å–∞ `'ok'` (–¥–∞–∂–µ –µ—Å–ª–∏ `avg_days = 1`)

### –î–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ (–∫–Ω–æ–ø–∫–∞)
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å: `quantity = -1`
- `isEarlyDepletion = true`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `'ending-soon'` –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–∞—Ç—ã –ø–æ–∫—É–ø–∫–∏

## –§–∞–π–ª—ã

### –ò–∑–º–µ–Ω–µ–Ω—ã:
- ‚úÖ `src/services/supabaseService.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞

### –î–æ–±–∞–≤–ª–µ–Ω—ã:
- ‚úÖ `FIX_EARLY_DEPLETION_BUTTON.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- ‚úÖ `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_–î–û–°–†–û–ß–ù–û–ì–û_–û–ö–û–ù–ß–ê–ù–ò–Ø.md` - –∫—Ä–∞—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Ä—É—Å—Å–∫–∏–π)
- ‚úÖ `SUMMARY_EARLY_DEPLETION_FIX.md` - —ç—Ç–æ —Ä–µ–∑—é–º–µ

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–ø–ª–æ—è

```bash
cd /Users/d.chistoforov/Desktop/Grocery

# –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add src/services/supabaseService.ts \
  FIX_EARLY_DEPLETION_BUTTON.md \
  –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_–î–û–°–†–û–ß–ù–û–ì–û_–û–ö–û–ù–ß–ê–ù–ò–Ø.md \
  SUMMARY_EARLY_DEPLETION_FIX.md

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git commit -m "fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ (quantity=-1)
- –û–±—ã—á–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏: –≥–∞—Ä–∞–Ω—Ç–∏—è 2 –¥–Ω—è —Å—Ç–∞—Ç—É—Å–∞ 'ok'
- –î–æ—Å—Ä–æ—á–Ω–æ–µ –æ–∫–æ–Ω—á–∞–Ω–∏–µ: —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 'ending-soon'
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ–≥–¥–∞ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞"

# –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å
git push origin main
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –ù–∞–π–¥–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–í –Ω–∞–ª–∏—á–∏–∏" (–∑–µ–ª–µ–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞)
2. –ù–∞–∂–º–∏—Ç–µ –æ—Ä–∞–Ω–∂–µ–≤—É—é –∫–Ω–æ–ø–∫—É ‚ö†Ô∏è –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ó–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è" (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞)
   - ‚úÖ –û—Ä–∞–Ω–∂–µ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç
   - ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è –∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ üîÑ

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- `EARLY_DEPLETION_FEATURE.md` - –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- `VIRTUAL_PURCHASE_FEATURE.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)





